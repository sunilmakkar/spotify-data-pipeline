{"metadata": {"dbt_schema_version": "https://schemas.getdbt.com/dbt/run-results/v6.json", "dbt_version": "1.10.15", "generated_at": "2025-12-01T21:04:49.021458Z", "invocation_id": "3d42ee95-06e4-451c-bf54-5e99da8e5918", "invocation_started_at": "2025-12-01T21:04:39.994302Z", "env": {}}, "results": [{"status": "success", "timing": [{"name": "compile", "started_at": "2025-12-01T21:04:44.636931Z", "completed_at": "2025-12-01T21:04:44.649562Z"}, {"name": "execute", "started_at": "2025-12-01T21:04:44.650100Z", "completed_at": "2025-12-01T21:04:47.205504Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 2.617698907852173, "adapter_response": {"_message": "SUCCESS 1", "code": "SUCCESS", "rows_affected": 1, "query_id": "01c0c450-0004-03a9-000a-68a2000170c2"}, "message": "SUCCESS 1", "failures": null, "unique_id": "model.spotify_analytics.silver_plays", "compiled": true, "compiled_code": "\n\n-- ============================================================================\n-- SILVER LAYER: CLEANED PLAYS DATA\n-- ============================================================================\n-- Purpose: Transform bronze plays data into clean, analytics-ready format\n-- \n-- Transformations:\n--   1. Deduplicate records (DISTINCT on event_id)\n--   2. Cast all data types from VARIANT to proper types\n--   3. Filter invalid records (defensive WHERE clauses)\n--   4. Add processing metadata (processed_at timestamp)\n--\n-- Source: bronze.plays (external table reading from S3 Parquet files)\n-- Target: SILVER.silver_plays (materialized table)\n-- ============================================================================\n\nWITH source_data AS (\n    SELECT \n        VALUE:event_id::VARCHAR AS event_id,\n        VALUE:user_id::VARCHAR AS user_id,\n        VALUE:event_type::VARCHAR AS event_type,\n        VALUE:track_id::VARCHAR AS track_id,\n        VALUE:track_name::VARCHAR AS track_name,\n        VALUE:artist_name::VARCHAR AS artist_name,\n        VALUE:album_name::VARCHAR AS album_name,\n        VALUE:duration_ms::NUMBER AS duration_ms,\n        VALUE:played_at::VARCHAR AS played_at,\n        VALUE:device_type::VARCHAR AS device_type\n    FROM spotify_data.bronze.plays\n),\n\ndeduplicated AS (\n    SELECT DISTINCT\n        event_id,\n        user_id,\n        event_type,\n        track_id,\n        track_name,\n        artist_name,\n        album_name,\n        duration_ms,\n        played_at,\n        device_type\n    FROM source_data\n    WHERE \n        -- Data quality filters\n        user_id IS NOT NULL\n        AND duration_ms > 0\n        AND duration_ms < 600000  -- Less than 10 minutes (catches data errors)\n        AND event_id IS NOT NULL\n)\n\nSELECT \n    -- Identifiers\n    event_id::VARCHAR AS event_id,\n    user_id::VARCHAR AS user_id,\n    event_type::VARCHAR AS event_type,\n    \n    -- Track information\n    track_id::VARCHAR AS track_id,\n    track_name::VARCHAR AS track_name,\n    artist_name::VARCHAR AS artist_name,\n    album_name::VARCHAR AS album_name,\n    \n    -- Metrics\n    duration_ms::NUMBER AS duration_ms,\n    \n    -- Timestamps\n    TRY_CAST(played_at AS TIMESTAMP) AS played_at,\n    \n    -- Device context\n    device_type::VARCHAR AS device_type,\n    \n    -- Metadata\n    CURRENT_TIMESTAMP() AS processed_at\n    \nFROM deduplicated", "relation_name": "spotify_data.silver.silver_plays", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-12-01T21:04:47.284604Z", "completed_at": "2025-12-01T21:04:47.321372Z"}, {"name": "execute", "started_at": "2025-12-01T21:04:47.322035Z", "completed_at": "2025-12-01T21:04:48.796773Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 1.5678706169128418, "adapter_response": {"_message": "SUCCESS 1", "code": "SUCCESS", "rows_affected": 1, "query_id": "01c0c450-0004-03a9-000a-68a2000170ca"}, "message": "SUCCESS 1", "failures": null, "unique_id": "model.spotify_analytics.top_artists", "compiled": true, "compiled_code": "\n\n-- ============================================================================\n-- GOLD LAYER: TOP ARTISTS BY PLAY COUNT\n-- ============================================================================\n-- Purpose: Aggregate and rank artists by popularity\n-- \n-- Grain: One row per artist (all-time aggregation)\n-- Primary Key: artist_name\n--\n-- Metrics:\n--   - Total plays per artist\n--   - Total listening time\n--   - Number of unique tracks played\n--   - First and last play timestamps\n--   - Popularity rank\n--\n-- Source: SILVER.silver_plays\n-- Target: GOLD.top_artists\n-- ============================================================================\n\nWITH artist_aggregates AS (\n    SELECT \n        -- Artist identifier\n        artist_name,\n        \n        -- Aggregate metrics\n        COUNT(*) AS total_plays,\n        SUM(duration_ms) AS total_listening_time_ms,\n        COUNT(DISTINCT track_id) AS unique_tracks,\n        MIN(played_at) AS first_played_at,\n        MAX(played_at) AS last_played_at\n        \n    FROM spotify_data.silver.silver_plays\n    GROUP BY artist_name\n),\n\nranked_artists AS (\n    SELECT \n        *,\n        -- Add ranking based on play count (1 = most played artist)\n        ROW_NUMBER() OVER (ORDER BY total_plays DESC, total_listening_time_ms DESC) AS rank\n    FROM artist_aggregates\n)\n\nSELECT \n    -- Identifier\n    artist_name::VARCHAR AS artist_name,\n    \n    -- Metrics\n    total_plays::NUMBER AS total_plays,\n    total_listening_time_ms::NUMBER AS total_listening_time_ms,\n    unique_tracks::NUMBER AS unique_tracks,\n    \n    -- Timestamps\n    first_played_at::TIMESTAMP AS first_played_at,\n    last_played_at::TIMESTAMP AS last_played_at,\n    \n    -- Ranking\n    rank::NUMBER AS rank\n    \nFROM ranked_artists\nORDER BY rank", "relation_name": "spotify_data.gold.top_artists", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-12-01T21:04:47.314673Z", "completed_at": "2025-12-01T21:04:47.325492Z"}, {"name": "execute", "started_at": "2025-12-01T21:04:47.325918Z", "completed_at": "2025-12-01T21:04:48.811706Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 1.5663707256317139, "adapter_response": {"_message": "SUCCESS 1", "code": "SUCCESS", "rows_affected": 1, "query_id": "01c0c450-0004-03a9-000a-68a2000170ce"}, "message": "SUCCESS 1", "failures": null, "unique_id": "model.spotify_analytics.top_tracks", "compiled": true, "compiled_code": "\n\n-- ============================================================================\n-- GOLD LAYER: TOP TRACKS BY PLAY COUNT\n-- ============================================================================\n-- Purpose: Aggregate and rank tracks by popularity\n-- \n-- Grain: One row per track (all-time aggregation)\n-- Primary Key: track_id\n--\n-- Metrics:\n--   - Total plays per track\n--   - Total listening time\n--   - First and last play timestamps\n--   - Popularity rank\n--\n-- Source: SILVER.silver_plays\n-- Target: GOLD.top_tracks\n-- ============================================================================\n\nWITH track_aggregates AS (\n    SELECT \n        -- Track identifiers and attributes\n        track_id,\n        track_name,\n        artist_name,\n        album_name,\n        \n        -- Aggregate metrics\n        COUNT(*) AS total_plays,\n        SUM(duration_ms) AS total_listening_time_ms,\n        MIN(played_at) AS first_played_at,\n        MAX(played_at) AS last_played_at\n        \n    FROM spotify_data.silver.silver_plays\n    GROUP BY \n        track_id,\n        track_name,\n        artist_name,\n        album_name\n),\n\nranked_tracks AS (\n    SELECT \n        *,\n        -- Add ranking based on play count (1 = most played)\n        ROW_NUMBER() OVER (ORDER BY total_plays DESC, total_listening_time_ms DESC) AS rank\n    FROM track_aggregates\n)\n\nSELECT \n    -- Identifiers\n    track_id::VARCHAR AS track_id,\n    track_name::VARCHAR AS track_name,\n    artist_name::VARCHAR AS artist_name,\n    album_name::VARCHAR AS album_name,\n    \n    -- Metrics\n    total_plays::NUMBER AS total_plays,\n    total_listening_time_ms::NUMBER AS total_listening_time_ms,\n    \n    -- Timestamps\n    first_played_at::TIMESTAMP AS first_played_at,\n    last_played_at::TIMESTAMP AS last_played_at,\n    \n    -- Ranking\n    rank::NUMBER AS rank\n    \nFROM ranked_tracks\nORDER BY rank", "relation_name": "spotify_data.gold.top_tracks", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-12-01T21:04:47.271771Z", "completed_at": "2025-12-01T21:04:47.324518Z"}, {"name": "execute", "started_at": "2025-12-01T21:04:47.332049Z", "completed_at": "2025-12-01T21:04:48.820159Z"}], "thread_id": "Thread-3 (worker)", "execution_time": 1.6507823467254639, "adapter_response": {"_message": "SUCCESS 1", "code": "SUCCESS", "rows_affected": 1, "query_id": "01c0c450-0004-03a9-000a-68a2000170c6"}, "message": "SUCCESS 1", "failures": null, "unique_id": "model.spotify_analytics.daily_user_stats", "compiled": true, "compiled_code": "\n\n-- ============================================================================\n-- GOLD LAYER: DAILY USER LISTENING STATISTICS\n-- ============================================================================\n-- Purpose: Aggregate user listening behavior by day\n-- \n-- Grain: One row per user per day\n-- Primary Key: (date, user_id)\n--\n-- Metrics:\n--   - Total plays per day\n--   - Total listening time\n--   - Unique tracks/artists played\n--   - Average track duration\n--\n-- Source: SILVER.silver_plays\n-- Target: GOLD.daily_user_stats\n-- ============================================================================\n\nWITH daily_aggregates AS (\n    SELECT \n        -- Date dimension (truncate timestamp to date)\n        DATE(played_at) AS date,\n        \n        -- User identifier\n        user_id,\n        \n        -- Aggregate metrics\n        COUNT(*) AS total_plays,\n        SUM(duration_ms) AS total_listening_time_ms,\n        COUNT(DISTINCT track_id) AS unique_tracks,\n        COUNT(DISTINCT artist_name) AS unique_artists,\n        AVG(duration_ms) AS avg_track_duration_ms\n        \n    FROM spotify_data.silver.silver_plays\n    GROUP BY \n        DATE(played_at),\n        user_id\n)\n\nSELECT \n    -- Dimensions\n    date,\n    user_id,\n    \n    -- Metrics (cast for clarity)\n    total_plays::NUMBER AS total_plays,\n    total_listening_time_ms::NUMBER AS total_listening_time_ms,\n    unique_tracks::NUMBER AS unique_tracks,\n    unique_artists::NUMBER AS unique_artists,\n    ROUND(avg_track_duration_ms, 2)::NUMBER AS avg_track_duration_ms\n    \nFROM daily_aggregates\nORDER BY date DESC, user_id", "relation_name": "spotify_data.gold.daily_user_stats", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-12-01T21:04:47.306796Z", "completed_at": "2025-12-01T21:04:47.324951Z"}, {"name": "execute", "started_at": "2025-12-01T21:04:47.329344Z", "completed_at": "2025-12-01T21:04:48.935594Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 1.7345857620239258, "adapter_response": {"_message": "SUCCESS 1", "code": "SUCCESS", "rows_affected": 1, "query_id": "01c0c450-0004-03d6-000a-68a20001a012"}, "message": "SUCCESS 1", "failures": null, "unique_id": "model.spotify_analytics.device_usage", "compiled": true, "compiled_code": "\n\n-- ============================================================================\n-- GOLD LAYER: DEVICE USAGE STATISTICS\n-- ============================================================================\n-- Purpose: Aggregate listening behavior by device type\n-- \n-- Grain: One row per device type (all-time aggregation)\n-- Primary Key: device_type\n--\n-- Metrics:\n--   - Total plays per device\n--   - Total listening time\n--   - Percentage of total plays\n--   - Average track duration\n--\n-- Source: SILVER.silver_plays\n-- Target: GOLD.device_usage\n-- ============================================================================\n\nWITH device_aggregates AS (\n    SELECT \n        -- Device identifier\n        device_type,\n        \n        -- Aggregate metrics\n        COUNT(*) AS total_plays,\n        SUM(duration_ms) AS total_listening_time_ms,\n        AVG(duration_ms) AS avg_track_duration_ms\n        \n    FROM spotify_data.silver.silver_plays\n    GROUP BY device_type\n),\n\ntotal_plays_calc AS (\n    -- Calculate overall total for percentage calculation\n    SELECT SUM(total_plays) AS overall_total_plays\n    FROM device_aggregates\n)\n\nSELECT \n    -- Identifier\n    device_type::VARCHAR AS device_type,\n    \n    -- Metrics\n    total_plays::NUMBER AS total_plays,\n    total_listening_time_ms::NUMBER AS total_listening_time_ms,\n    \n    -- Percentage of total plays\n    ROUND((total_plays::FLOAT / overall_total_plays::FLOAT) * 100, 2)::FLOAT AS play_percentage,\n    \n    -- Average duration\n    ROUND(avg_track_duration_ms, 2)::NUMBER AS avg_track_duration_ms\n    \nFROM device_aggregates\nCROSS JOIN total_plays_calc\nORDER BY total_plays DESC", "relation_name": "spotify_data.gold.device_usage", "batch_results": null}], "elapsed_time": 6.306479215621948, "args": {"populate_cache": true, "profiles_dir": "/opt/airflow/dbt", "print": true, "require_generic_test_arguments_property": true, "cache_selected_only": false, "introspect": true, "require_resource_names_without_spaces": true, "write_json": true, "log_format_file": "debug", "use_fast_test_edges": false, "require_all_warnings_handled_by_warn_error": false, "source_freshness_run_project_hooks": true, "partial_parse": true, "show_resource_report": false, "state_modified_compare_more_unrendered_values": false, "warn_error_options": {"error": [], "warn": [], "silence": []}, "use_colors_file": true, "macro_debugging": false, "send_anonymous_usage_stats": true, "log_path": "/opt/airflow/dbt/logs", "which": "run", "project_dir": "/opt/airflow/dbt", "show_all_deprecations": false, "favor_state": false, "log_file_max_bytes": 10485760, "static_parser": true, "require_batched_execution_for_custom_microbatch_strategy": false, "quiet": false, "use_colors": true, "log_level": "info", "exclude": [], "partial_parse_file_diff": true, "skip_nodes_if_on_run_start_fails": false, "require_yaml_configuration_for_mf_time_spines": false, "require_nested_cumulative_type_params": false, "validate_macro_args": false, "select": [], "empty": false, "require_explicit_package_overrides_for_builtin_materializations": true, "strict_mode": false, "defer": false, "printer_width": 80, "vars": {}, "invocation_command": "dbt run", "indirect_selection": "eager", "upload_to_artifacts_ingest_api": false, "version_check": true, "log_level_file": "debug", "state_modified_compare_vars": false, "log_format": "default"}}